!function(e){e.fn.jsonSuggest=function(t){var i,a={url:"",data:[],minCharacters:1,maxResults:void 0,wildCard:"",caseSensitive:!1,notCharacter:"!",maxHeight:350,highlightMatches:!0,onSelect:void 0,width:void 0,property:"text"};return t=e.extend(a,t),this.each(function(){function a(e,t){var i=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];if(t)for(var a=0;a<i.length;a++)i[a]===t&&i.splice(a,1);var n=new RegExp("(\\"+i.join("|\\")+")","g");return e.replace(n,"\\$1")}var n,o,r,s=e(this),l=new RegExp(a(t.wildCard||""),"g"),h=e("<ul />");function u(t){e("li a",h).removeClass("ui-state-hover"),t&&e("a",t).addClass("ui-state-hover"),n=t}function c(i,a){a="("+a+")";var o,r=!0,l=0,c=t.caseSensitive?new RegExp(a,"g"):new RegExp(a,"ig");for(e(h).html("").hide(),o=0;o<i.length;o+=1){var d=e("<li />"),f=i[o].fields.name;if(!0===t.highlightMatches&&(f=f.replace(c,"<strong>$1</strong>")),e(d).append('<a class="ui-corner-all">'+f+"</a>"),"None"!=i[o].fields.ds_thm&&e(">a",d).prepend('<img src="'+i[o].fields.ds_thm+'" />'),"int"==typeof i[o].fields.ds_year&&e(">a",d).append("<small>"+i[o].fields.ds_year+"</small>"),e(d).addClass("ui-menu-item").addClass(r?"odd":"even").attr("role","menuitem").click(function(a){return function(){var n;n=i[a],s.val(n[t.property]),e(h).html("").hide(),"function"==typeof t.onSelect&&t.onSelect(n)}}(o)).mouseover(function(e){return function(){u(e)}}(d)),e(h).append(d),r=!r,l+=1,"number"==typeof t.maxResults&&l>=t.maxResults)break}e("li",h).length>0&&(n=void 0,e(h).show().css("height","auto"),e(h).height()>t.maxHeight&&e(h).css({overflow:"auto",height:t.maxHeight+"px"}))}function d(){e(h).html("").hide()}e(h).addClass("jsonSuggest ui-autocomplete ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","listbox").css({top:s.position().top+s.outerHeight()+"px",left:s.position().left+"px",width:t.width||s.outerWidth()+"px","z-index":999}).hide(),s.after(h).keyup(function(o){switch(o.keyCode){case 13:return e(n).trigger("click"),!1;case 40:return u(n=void 0===n?e("li:first",h).get(0):e(n).next().get(0)),n&&e(h).scrollTop(n.offsetTop),!1;case 38:return u(n=void 0===n?e("li:last",h).get(0):e(n).prev().get(0)),n&&e(h).scrollTop(n.offsetTop),!1;default:(function(n){if(t.data&&t.data.length)(function(e){if(this.value.length<t.minCharacters)return d(),!1;var i,n,o=[],r=t.wildCard?a(this.value,t.wildCard).replace(l,".*"):a(this.value),s=!0;for(t.notCharacter&&0===r.indexOf(t.notCharacter)&&(r=r.substr(t.notCharacter.length,r.length)).length>0&&(s=!1),r=r||".*",r=t.wildCard?"^"+r:r,i=t.caseSensitive?new RegExp(r):new RegExp(r,"i"),n=0;n<e.length;n+=1)i.test(e[n][t.property])===s&&o.push(e[n]);c(o,r)}).apply(this,[t.data]);else if(t.url&&"string"==typeof t.url){var o=this.value;if(o.length<t.minCharacters)return d(),!1;e(h).html('<li class="ui-menu-item ajaxSearching"><a class="ui-corner-all">Searching...</a></li>').show().css("height","auto"),i=window.clearTimeout(i),i=window.setTimeout(function(){e.getJSON(t.url,{search:o},function(e){e?c(e,o):d()})},500)}}).apply(this,[o])}}).keydown(function(t){if((9===t.keyCode||13===t.keyCode)&&n)return e(n).trigger("click"),!0}).blur(function(t){var i=e(h).offset();i.bottom=i.top+e(h).height(),i.right=i.left+e(h).width(),(r<i.top||r>i.bottom||o<i.left||o>i.right)&&e(h).hide()}).focus(function(t){e(h).css({top:s.position().top+s.outerHeight()+"px",left:s.position().left+"px"}),e("li",h).length>0&&e(h).show()}).attr("autocomplete","off"),e(window).mousemove(function(e){o=e.pageX,r=e.pageY}),t.notCharacter=a(t.notCharacter||""),t.data&&"string"==typeof t.data&&(t.data=e.parseJSON(t.data))})}}(jQuery);